<div>
	<input id="csrf_token" type="hidden" value="<%= csrf_token %>" />
	<div class="h1-button">
		<h1>Admin Management</h1>
		<button type="button" class="btn btn-primary" onclick="location.href='/api/logout'">Logout</button>
	</div>
	<hr />
	<% if (data.error) { %>
	<h3><%= data.error.toString() %></h3>
	<% } else { %>
	<div class="card-columns">
		<% for (let question of data.questions) { %>
		<div id="<%= question.id %>" class="card bg-light mb-3">
			<div class="card-header"><%= question.problem %><button type="button" class="close delete" data-toggle="modal" data-target="#confirmation">&times;</button></div>
			<div class="card-body">
				<div>
					<h5 class="card-title"><%= question.username %></h5>
					<p class="card-text"><%= question.contents %></p>
				</div>
				<div class="text-muted"><%= question.time %></div>
			</div>
		</div>
		<% } %>
	</div>
	<div id="confirmation" class="modal fade">
		<div class="modal-dialog">
			<div class="modal-content">
				<div class="modal-header">
					<h5 class="modal-title">Comfirm Delete</h5>
					<button type="button" class="close" data-dismiss="modal" aria-label="Close">
						<span>&times;</span>
					</button>
				</div>
				<div class="modal-body">
					<p>Are you sure you want to delete this?</p>
					<strong>This operation cannot be undone!</strong>
				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-secondary" data-dismiss="modal">No</button>
					<button id="yes" type="button" class="btn btn-primary" data-dismiss="modal">Yes</button>
				</div>
			</div>
		</div>
	</div>
	<% } %>
</div>
<script>
	var last_click_id = 0;
	$(document).ready(function() {
		$('#yes').on('click', function() {
			console.log($('#csrf_token').val());
			$.ajax({
				url: '/api/delete',
				type: 'POST',
				data: {
					id: id,
					csrf_token: $('#csrf_token').val()
				},
				success: function(res) {
					if (res.cnt === 1) {
						$('#' + id).remove();
						if ($('.card-columns').children().length === 0) {
							$('<h4>').text('There are no questions.').appendTo($('.card-columns').parent());
						}
					}
				},
				fail: function(xhr, textStatus, errorThrown) {
					console.log(xhr, textStatus, errorThrown);
				}
			})
		})
		$('.delete').on('click', function() {
			id = $(this).parent().parent().attr('id');
		});
		if ($('.card-columns').children().length === 0) {
			$('<h4>').text('There are no questions.').appendTo($('.card-columns').parent());
		}
	});
</script>
